.content
  .header
    %h1.page-title= @pallet.name
    %ul.breadcrumb
      %li
        = link_to "Home", index_path
      = present(@pallet).breadcrumbs

    = add_button(new_box_path(pallet_id: @pallet.id), "Box", "fa-box-open")
    = manage_button(pallet_pallet_items_path(@pallet), "Item", "fa-stethoscope")

  .main-content
    %ul.nav.nav-tabs
      %li.active
        %a{data: {toggle: "tab"}, href: "#view"} View
      %li
        %a{data: {toggle: "tab"}, href: "#edit"} Edit
    .row
      .col-md-5
        %br
        #myTabContent.tab-content
          #view.tab-pane.active.in
            .row
              .col-xs-12
                %h5.text-muted Name
                %h4= @pallet.name
              - if @pallet.notes.present?
                .col-xs-12
                  %h5.text-muted Notes
                  %h4= @pallet.notes
              .col-lg-3.col-sm-4.col-xs-6
                %h5.text-muted Custom ID
                %h4= @pallet.custom_uid
              .col-lg-3.col-sm-4.col-xs-6
                %h5.text-muted Status
                %h4= @pallet.status
              .col-lg-3.col-sm-4.col-xs-6
                %h5.text-muted Created By
                %h4= @pallet.user.name
              .col-lg-3.col-sm-4.col-xs-6
                %h5.text-muted Created At
                %h4= @pallet.created_at.strftime("%Y-%m-%d")

          #edit.tab-pane.fade
            = render partial: "form"

      .col-md-7
        %br
        - present(@pallet) do |pallet|
          .panel.panel-default
            %a.panel-heading{data: {toggle: "collapse"}, href: "#location"}
              Location Details
            #location.collapse.in
              %table.table.list
                %tbody
                  %tr
                    %td
                      %p Container
                    = pallet.container_location
                  %tr
                    %td
                      %p Shipment
                    = pallet.shipment_location

        .panel.panel-default
          %a.panel-heading{data: {toggle: "collapse"}, href: "#boxes"}
            Boxes on this Pallet
            %span.label{class: @pallet.boxes.any? ? "label-success" : "label-warning"}= @pallet.boxes.size
          - if @pallet.boxes.any?
            #boxes.collapse
              = render partial: "layouts/quick_filter", locals: {placeholder: "Quick filter a box by ID...", assoc: "boxes"}

              %table.table.table-striped
                %thead
                  %tr
                    %th Custom ID
                    %th Name
                    %th Status
                %tbody#filter-boxes-table
                  - @pallet.boxes.order(:custom_uid).reverse_order.each do |box|
                    %tr.filter-row
                      %td= box.custom_uid
                      %td
                        = link_to box_path(box) do
                          = box.name
                      %td= box.status
              .close-collapse{data: {toggle: "collapse"}, href: "#boxes"}
                %span Close
          - else
            #boxes.collapse.panel-body
              %p No boxes.

        .panel.panel-default
          %a.panel-heading.collapsed{data: {toggle: "collapse"}, href: "#pallet_items"}
            Packed Items on this Pallet
            %span.label{class: @pallet.boxes.any? ? "label-success" : "label-warning"}= @pallet.pallet_items.size
          - if @pallet.pallet_items.any?
            #pallet_items.collapse
              = render partial: "layouts/quick_filter", locals: {placeholder: "Quick filter an item by name...", assoc: "pallet-items"}

              %table.table.table-striped
                %thead
                  %tr
                    %th Name
                    %th Expires
                    %th Quantity
                %tbody#filter-pallet-items-table
                  - @pallet.pallet_items.order(:updated_at).reverse_order.each do |pi|
                    %tr.filter-row
                      %td
                        = link_to item_path(pi.item) do
                          = pi.generated_name
                      %td= pi.expiry_date&.strftime("%Y-%m-%d")
                      %td= pi.quantity
              .close-collapse{data: {toggle: "collapse"}, href: "#pallet_items"}
                %span Close
          - else
            #pallet_items.collapse.panel-body
              %p No packed items.
