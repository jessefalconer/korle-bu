.content
  .header
    %ul.breadcrumb
      %li
        = link_to "Home", index_path
      = present(@container).breadcrumbs

    - if can? :read, Container
      = link_index_button(containers_path, "fa-truck")
    %h5 Add to this Container:
    - if can? :create, Pallet
      = add_button(new_pallet_path(container_id: @container.id), "Pallet", "fa-pallet")
    - if can? :create, Box
      = add_button(new_box_path(container_id: @container.id), "Box", "fa-box-open")
    = manage_button(container_container_items_path(@container), "Items", "fa-stethoscope")

    %button.btn.btn-primary{data: {target: "#mass-action-modal", toggle: "modal"}, disabled: true}
      %span.mass-action-count Mass Action
      %i.fa.fa-angle-double-right
    = render partial: "layouts/mass_action_modal", locals: {name: @container.name, redirect: container_path(@container), record: @container}

  .main-content
    %ul.nav.nav-tabs
      %li.active
        %a{data: {toggle: "tab"}, href: "#view"} View
      - if can? :manage, Container
        %li
          %a{data: {toggle: "tab"}, href: "#edit"} Edit
    .row
      .col-md-5
        %br
        #myTabContent.tab-content
          #view.tab-pane.active.in
            .row
              .col-xs-12
                %h5.text-muted Name
                %h4= @container.name
                %hr
              - if @container.notes.present?
                .col-xs-12
                  %h6.text-muted Notes
                  %h5= @container.notes
              .col-xs-6.col-sm-4.col-md-6
                %h6.text-muted Custom ID
                %h5= @container.custom_uid
              .col-xs-6.col-sm-4.col-md-6
                %h6.text-muted Status
                %h5{class: "status-#{@container.status.parameterize}"}= @container.status
              .col-xs-6.col-sm-4.col-md-6
                %h6.text-muted Weight (kg)
                %h5= @container.weight.to_f.round(4) || "N/A"
              .col-xs-6.col-sm-4.col-md-6
                %h6.text-muted Created By
                %h5= @container.user.name
              .col-xs-6.col-sm-4.col-md-6
                %h6.text-muted Created At
                %h5= @container.created_at.strftime("%Y-%m-%d")

          - if can? :manage, Container
            #edit.tab-pane.fade
              = render partial: "form"

      .col-md-7
        %br
        - present(@container) do |container|
          .panel.panel-default
            %a.panel-heading{data: {toggle: "collapse"}, href: "#location"}
              %i.fa.fa-map-marker-alt
              Location Details
            #location.collapse.in
              %table.table.list
                %tbody
                  %tr
                    %td
                      %p Warehouse
                    = container.warehouse_location
                  %tr
                    %td
                      %p Shipment
                    = container.shipment_location

        .panel.panel-default
          %a.panel-heading{data: {toggle: "collapse"}, href: "#pallets"}
            %i.fa.fa-pallet
            Pallets in this Container
            %span.label{class: @container.pallets.any? ? "label-success" : "label-warning"}= @container.pallets.size

          - if @container.pallets.any?
            #pallets.collapse
              = render partial: "layouts/table_quick_filter", locals: {placeholder: "Filter by custom ID...", assoc: "pallets"}

              %table.table.table-striped.link-rows
                %thead
                  %tr
                    %th Custom ID
                    %th Name
                    %th Status
                    %th
                %tbody#filter-pallets-table
                  - @container.pallets.order(:custom_uid).reverse_order.each do |pallet|
                    %tr.filter-row
                      %td
                        = link_to pallet_path(pallet) do
                          %p= pallet.custom_uid
                      %td
                        = link_to pallet_path(pallet) do
                          %p= pallet.name
                      %td
                        = link_to pallet_path(pallet) do
                          %p{class: "status-#{pallet.status.parameterize}"}= pallet.status
                      %td
                        = check_box_tag "pallet_ids[]", pallet.id, false, class: "mass-action-table", form: "mass_action", id: "mass-action-pallet-#{pallet.id}"
              .close-collapse{data: {toggle: "collapse"}, href: "#pallets"}
                %span Close
          - else
            #pallets.collapse.panel-body
              %h5.text-center No pallets in this container.

        .panel.panel-default
          %a.panel-heading{data: {toggle: "collapse"}, href: "#boxes"}
            %i.fa.fa-box-open
            Boxes in this Container
            %span.label{class: @container.boxes.any? ? "label-success" : "label-warning"}= @container.boxes.size

          - if @container.boxes.any?
            #boxes.collapse
              = render partial: "layouts/table_quick_filter", locals: {placeholder: "Filter by custom ID...", assoc: "boxes"}

              %table.table.table-striped.link-rows
                %thead
                  %tr
                    %th Custom ID
                    %th Name
                    %th Status
                    %th
                %tbody#filter-boxes-table
                  - @container.boxes.order(:custom_uid).reverse_order.each do |box|
                    %tr.filter-row
                      %td
                        = link_to box_path(box) do
                          %p= box.custom_uid
                      %td
                        = link_to box_path(box) do
                          %p= box.name
                      %td
                        = link_to box_path(box) do
                          %p{class: "status-#{box.status.parameterize}"}= box.status
                      %td
                        = check_box_tag "box_ids[]", box.id, false, class: "mass-action-table", form: "mass_action", id: "mass-action-box-#{box.id}"
              .close-collapse{data: {toggle: "collapse"}, href: "#boxes"}
                %span Close
          - else
            #boxes.collapse.panel-body
              %h5.text-center No boxes in this container.

        .panel.panel-default
          %a.panel-heading.collapsed{data: {toggle: "collapse"}, href: "#container_items"}
            %i.fa.fa-stethoscope
            Packed Items in this Container
            %span.label{class: @container.container_items.any? ? "label-success" : "label-warning"}= @container.container_items.size

          - if @container.container_items.any?
            #container_items.collapse
              = render partial: "layouts/table_quick_filter", locals: {placeholder: "Filter by name...", assoc: "container-items"}

              %table.table.table-striped.link-rows
                %thead
                  %tr
                    %th Name
                    %th Expires
                    %th Quantity
                    %th
                %tbody#filter-container-items-table
                  - @container.container_items.order(:updated_at).reverse_order.each do |ci|
                    %tr.filter-row
                      %td
                        = link_to container_container_items_path(@container) do
                          %p= ci.generated_name
                      %td
                        = link_to container_container_items_path(@container) do
                          %p= ci.expiry_date&.strftime("%Y-%m-%d")
                      %td
                        = link_to container_container_items_path(@container) do
                          %p= ci.quantity
                      %td
                        = check_box_tag "packed_item_ids[]", ci.id, false, class: "mass-action-table", form: "mass_action", id: "mass-action-packed-item-#{ci.id}"
              .close-collapse{data: {toggle: "collapse"}, href: "#container_items"}
                %span Close
          - else
            #container_items.collapse.panel-body
              %h5.text-center No packed items in this container.

  - if (can? :manage, PackedItem) && (@staged_items.any? || @staged_boxes.any? || @staged_pallets.any? || @warehoused_items.any? || @warehoused_boxes.any? || @warehoused_pallets.any?)
    = render "layouts/mass_action_add", display: %i[items boxes pallets]
